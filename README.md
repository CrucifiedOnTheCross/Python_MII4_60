# MII4_60 Python - Система цифровой интерферометрии

Это Python-версия интерферометра MII4_60, портированная с Processing/Java. Система предназначена для высокоточных измерений фазовых характеристик оптических поверхностей методом цифровой интерферометрии.

## Описание проекта

MII4_60 Python представляет собой комплексную систему для проведения интерферометрических измерений с использованием современных алгоритмов обработки фазовых данных. Система поддерживает 3-, 4- и 5-шаговые алгоритмы фазового анализа, обеспечивая высокую точность измерений для различных типов оптических поверхностей.

### Основные возможности

- **Многошаговые алгоритмы**: Поддержка 3-, 4- и 5-шаговых алгоритмов фазового анализа
- **Управление оборудованием**: Интеграция с камерами и Arduino-контроллерами
- **Обработка фазы**: Развертка фазы, удаление трендов, полиномиальная коррекция
- **Визуализация**: Цветовое отображение фазовых данных с настраиваемыми палитрами
- **Запись данных**: DPI-запись последовательности измерений
- **Экспорт данных**: Сохранение в форматах PNG и CSV

### Технические характеристики

- **Разрешение камеры**: 640x480 пикселей (настраиваемое)
- **Частота кадров**: 30 FPS
- **Длина волны**: 632.8 нм (настраиваемая в диапазоне 400-800 нм)
- **Задержка между измерениями**: 10-1000 мс
- **Цветовая палитра**: 1280 цветов для фазового отображения

## Системные требования

### Программное обеспечение
- Python 3.8 или выше
- PySide6 для графического интерфейса
- OpenCV для работы с камерой
- NumPy и SciPy для численных вычислений
- scikit-image для обработки изображений
- pySerial для связи с Arduino

### Аппаратное обеспечение
- USB-камера или веб-камера
- Arduino-совместимый контроллер (опционально)
- Операционная система: Windows, Linux, macOS

## Установка

1. **Клонирование репозитория**:
```bash
git clone <repository-url>
cd Python_MII4_60
```

2. **Установка зависимостей**:
```bash
pip install -r requirements.txt
```

3. **Проверка установки**:
```bash
python main.py
```

## Запуск системы

### Базовый запуск
```bash
python main.py
```

### Конфигурация
Основные параметры системы настраиваются в файле `config.py`:
- Разрешение и частота кадров камеры
- Параметры Arduino-соединения
- Настройки алгоритмов обработки
- Пути к файлам данных

## Структура проекта

```
Python_MII4_60/
├── main.py                 # Точка входа приложения
├── config.py              # Конфигурационные параметры
├── requirements.txt       # Зависимости Python
├── README.md             # Документация проекта
├── DOCUMENTATION.md      # Техническая документация
├── gui/
│   └── main_window.py    # Главное окно приложения
├── hardware/
│   └── controller.py     # Управление камерой и Arduino
├── core/
│   ├── phase_processor.py # Алгоритмы обработки фазы
│   ├── visualizer.py     # Визуализация данных
│   └── dpi_recorder.py   # Запись DPI-последовательностей
├── data/
│   └── colorArray.csv    # Цветовая палитра
└── Java/                 # Оригинальная Java-версия (справочная)
```

## Использование

### Основной интерфейс

1. **Выбор камеры**: Выберите доступную камеру из выпадающего списка
2. **Настройка Arduino**: Подключите Arduino-контроллер (опционально)
3. **Параметры измерения**:
   - Количество шагов: 3, 4 или 5
   - Длина волны: 400-800 нм
   - Задержка между измерениями: 10-1000 мс
4. **Опции обработки**:
   - Развертка фазы
   - Удаление линейного тренда
   - Полиномиальная коррекция
   - Инверсия цветов

### Проведение измерений

1. Включите трансляцию камеры кнопкой "Включить трансляцию"
2. Настройте параметры измерения
3. Нажмите "Начать измерение" для запуска процесса
4. Результат отобразится в виде цветового фазового изображения
5. Сохраните результат кнопкой "Сохранить изображение"

### DPI-запись

Для записи последовательности измерений:
1. Нажмите "Начать DPI запись"
2. Выберите папку для сохранения
3. Проводите измерения - каждое будет автоматически сохранено
4. Остановите запись повторным нажатием кнопки

## Алгоритмы обработки

### Вычисление фазы

Система поддерживает три алгоритма:

**3-шаговый алгоритм**:
```
φ = arctan(√3 * (I₂ - I₁) / (2*I₀ - I₁ - I₂))
```

**4-шаговый алгоритм**:
```
φ = arctan((I₀ - I₂) / (I₃ - I₁))
```

**5-шаговый алгоритм**:
```
φ = arctan(2*(I₁ - I₃) / (2*I₂ - I₀ - I₄))
```

### Развертка фазы

Используется алгоритм scikit-image для устранения 2π-разрывов в фазовых данных.

### Удаление трендов

- **Линейный тренд**: Удаление наклона по горизонтали и вертикали
- **Полиномиальный тренд**: Коррекция сферических аберраций

## Форматы данных

### Входные данные
- Изображения с камеры в формате BGR/RGB
- Конвертация в оттенки серого для обработки

### Выходные данные
- **PNG**: Цветовые фазовые изображения
- **CSV**: Численные фазовые данные
- **Интерферограммы**: Усредненные изображения

## Разработка

### Архитектура
Система построена по модульному принципу:
- **GUI**: PySide6-интерфейс с многопоточностью
- **Hardware**: Абстракция для работы с оборудованием
- **Core**: Алгоритмы обработки и визуализации
- **Config**: Централизованная конфигурация

### Расширение функциональности
Для добавления новых алгоритмов:
1. Расширьте класс `PhaseProcessor`
2. Добавьте соответствующие элементы GUI
3. Обновите конфигурационные параметры

## Устранение неполадок

### Проблемы с камерой
- Проверьте подключение USB-камеры
- Убедитесь, что камера не используется другими приложениями
- Попробуйте изменить индекс камеры в настройках

### Проблемы с Arduino
- Проверьте правильность подключения к COM-порту
- Убедитесь в корректности скорости передачи (57600 baud)
- Проверьте драйверы Arduino

### Ошибки обработки
- Убедитесь в достаточном освещении для камеры
- Проверьте стабильность оптической системы
- Настройте параметры задержки между измерениями

## Лицензия

Проект разработан для научных и образовательных целей.
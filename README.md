# Система Интерферометрического Анализа MII4_60 (Python версия)

## Описание

Система интерферометрического анализа MII4_60 - это программа для обработки интерферометрических изображений с использованием метода фазового сдвига. Программа позволяет получать и обрабатывать данные с камеры, управлять Arduino для создания фазовых сдвигов и визуализировать результаты в виде цветных карт фазы.

## Основные возможности

- **Захват изображений с камеры** - поддержка различных USB-камер
- **Управление Arduino** - автоматическое управление фазовыми сдвигами через COM-порт
- **Алгоритмы обработки фазы**:
  - Вычисление свернутой фазы (3, 4 или 5 шагов)
  - Развертка фазы с использованием алгоритма scikit-image
  - Удаление линейного тренда
- **Визуализация результатов** - цветное отображение фазовых карт
- **Сохранение изображений** - экспорт результатов в PNG/JPEG

## Структура проекта

```
Python_MII4_60/
├── main.py                 # Точка входа в программу
├── config.py              # Конфигурационные параметры
├── requirements.txt       # Зависимости Python
├── gui/
│   └── main_window.py     # Главное окно интерфейса
├── hardware/
│   └── controller.py      # Контроллеры камеры и Arduino
├── core/
│   ├── phase_processor.py # Алгоритмы обработки фазы
│   └── visualizer.py      # Создание цветных изображений
└── data/
    └── colorArray.csv     # Цветовая палитра (1280 цветов)
```

## Установка и настройка

### Требования

- Python 3.8+
- Операционная система: Windows/Linux/macOS
- USB-камера (совместимая с OpenCV)
- Arduino (опционально, для автоматического управления фазовыми сдвигами)

### Установка зависимостей

1. Клонируйте или скачайте проект
2. Перейдите в директорию проекта:
   ```bash
   cd Python_MII4_60
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

### Основные зависимости

- **PySide6** - GUI фреймворк
- **OpenCV** - работа с камерой и обработка изображений
- **NumPy** - численные вычисления
- **scikit-image** - алгоритмы обработки изображений (развертка фазы)
- **pyserial** - связь с Arduino

## Запуск программы

### Основной способ запуска

```bash
python main.py
```

### Альтернативный запуск из виртуального окружения

```bash
# Создание виртуального окружения (если не создано)
python -m venv venv

# Активация виртуального окружения
# Windows:
venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate

# Установка зависимостей
pip install -r requirements.txt

# Запуск программы
python main.py
```

## Использование программы

### Интерфейс пользователя

Программа имеет графический интерфейс с двумя основными областями:

1. **Панель управления (слева)**:
   - Выбор камеры
   - Выбор COM-порта для Arduino
   - Настройка параметров измерения
   - Кнопки управления

2. **Область отображения (справа)**:
   - Просмотр результатов обработки
   - Цветная карта фазы

### Настройка параметров

- **Количество шагов**: 3, 4 или 5 (влияет на точность и скорость)
- **Задержка**: 50-2000 мс (время между захватами кадров)
- **Инвертировать цвета**: изменение цветовой схемы
- **Удалить линейный тренд**: компенсация наклона поверхности

### Процесс измерения

1. Подключите камеру и выберите её в списке
2. При наличии Arduino подключите его и выберите COM-порт
3. Настройте параметры измерения
4. Нажмите "Старт/Стоп" для начала измерения
5. Дождитесь завершения обработки
6. При необходимости сохраните результат

## Алгоритмы обработки

### Вычисление фазы

Программа поддерживает три алгоритма фазового сдвига:

- **3 шага**: `φ = arctan2(√3(I₂-I₁), 2I₀-I₁-I₂)`
- **4 шага**: `φ = arctan2(I₀-I₂, I₃-I₁)`
- **5 шагов**: `φ = arctan2(2(I₁-I₃), 2I₂-I₀-I₄)`

### Развертка фазы

Используется алгоритм из библиотеки scikit-image для устранения разрывов фазы.

### Удаление тренда

Двухэтапное удаление линейного тренда:
1. По строкам изображения
2. По столбцам изображения

## Конфигурация

Основные параметры настраиваются в файле `config.py`:

```python
DEFAULT_STEPS = 3              # Количество шагов по умолчанию
DEFAULT_LAMBDA = 632.8         # Длина волны (нм)
DEFAULT_THRESHOLD = 0.8        # Порог обработки
DEFAULT_DELAY = 300            # Задержка между кадрами (мс)
DEFAULT_CAMERA_RESOLUTION = (640, 480)  # Разрешение камеры
COLORMAP_FILE = "data/colorArray.csv"   # Путь к цветовой палитре
```

## Устранение неполадок

### Проблемы с камерой
- Убедитесь, что камера подключена и не используется другими приложениями
- Проверьте права доступа к камере
- Попробуйте другой USB-порт

### Проблемы с Arduino
- Проверьте правильность COM-порта
- Убедитесь, что Arduino не используется другими программами
- Проверьте скорость соединения (по умолчанию 57600 baud)

### Ошибки при запуске
- Убедитесь, что установлены все зависимости
- Проверьте версию Python (требуется 3.8+)
- Проверьте наличие файла `data/colorArray.csv`

## Технические особенности

- **Многопоточность**: обработка изображений выполняется в отдельном потоке
- **Формат данных**: изображения конвертируются в оттенки серого для обработки
- **Цветовая палитра**: 1280 цветов в формате HEX для визуализации фазы
- **Поддержка форматов**: сохранение в PNG и JPEG

## Автор и лицензия

Проект является Python-портом оригинальной Java/Processing версии системы интерферометрического анализа MII4_60.